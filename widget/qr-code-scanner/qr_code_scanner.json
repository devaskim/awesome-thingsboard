{
  "alias": "qr_code_scanner",
  "name": "QR code scanner",
  "image": "data:image/gif;base64,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",
  "description": "Use web or phone camera to scan QR code",
  "descriptor": {
    "type": "static",
    "sizeX": 5,
    "sizeY": 5,
    "resources": [],
    "templateHtml": "<div id=\"qr-container\">\r\n    <video id=\"qr-video\"></video>\r\n</div>",
    "templateCss": "",
    "controllerScript": "const SCRIPT_URL = 'https://cdn.jsdelivr.net/gh/nimiq/qr-scanner/qr-scanner.min.js';\n\nself.onInit = function() {\n    let $injector = self.ctx.$scope.$injector;\n    let utils = $injector.get(self.ctx.servicesMap.get('utils'));\n    \n    self.ctx.video = $('#qr-video', self.ctx.$container);\n    \n    let styleClass = '';\n    let styles = '';\n    \n    switch (self.ctx.settings.style) {\n        case 'shadow':\n            styleClass = 'qr-shadow-style';\n            styles = self.ctx.settings.shadowStyle;\n            break;\n        case 'stroke':\n            styleClass = 'qr-stroke-style';\n            styles = self.ctx.settings.strokeStyle;\n            break;\n        case 'custom':\n            styles = self.ctx.settings.customStyle;\n            break;\n        default:\n           styleClass = 'qr-shadow-style';\n           break;\n    }\n    \n    if (styleClass !== '') {\n        $('#qr-container', self.ctx.$container).addClass(styleClass);\n    }\n    \n    var cssParser = new cssjs();\n    cssParser.testMode = false;\n    var namespace = 'qr-code-scanner-' + hashCode(styles);\n    cssParser.cssPreviewNamespace = namespace;\n    cssParser.createStyleElement(namespace, styles);\n    self.ctx.$container.addClass(namespace);\n    \n    let onScanSuccess = onScanSuccessDefault;\n    if (typeof self.ctx.settings.onScanSuccess !== 'undefined' && \n                         self.ctx.settings.onScanSuccess.length > 0) {\n        let customCallback = new Function('qrCode', 'ctx', self.ctx.settings.onScanSuccess);\n        onScanSuccess = function(result) {\n            customCallback(result.data, self.ctx);\n        }\n    }\n    \n    \n    import(SCRIPT_URL)\n        .then((module) => {\n            console.debug('[QR scanner] Script imported from ', SCRIPT_URL);\n\n            const QrScanner = module.default;\n            \n            let options = {\n                onDecodeError: onScanFailureDefault,\n                highlightScanRegion: true,\n                highlightCodeOutline: true\n            };\n            \n            self.ctx.qrScanner = new QrScanner(self.ctx.video[0], onScanSuccess, options);\n            self.ctx.qrScanner.start()\n            .then(() => {\n                console.debug('[QR scanner] Initialized');\n            })\n            .catch(error => {\n                console.debug('[QR scanner] Initialization error: ', error);\n                \n                self.ctx.$container.html('<div style=\"margin: 0;position: absolute;top: 50%;left: 50%;-ms-transform: translate(-50%, -50%);transform: translate(-50%, -50%);text-align: justify;text-align-last: center;\"><p style=\"font-size: 1em;font-weight: bold;color: #DC143C;\">No camera on device or no access to camera has been granted!</p></div>');\n                self.ctx.$container.css(\"border\", \"3px solid #DC143C\");\n            });\n            \n            self.ctx.overlayContainer = $(self.ctx.qrScanner.$overlay);\n            \n            self.onResize();\n        })\n        .catch(err => {\n            console.error('[QR scanner] failed to import script: ', err.message);\n        });\n}\n\nfunction onScanSuccessDefault(result) {\n    alert('Default callback: scan result is ' + result.data);\n}\n\nfunction onScanFailureDefault(error) {\n    // NOTE: This function is being called very often\n    // console.error('[QR scanner] scan error: ', error);\n}\n\n\nself.onResize = function() {\n    self.ctx.video.width(self.ctx.width).height(self.ctx.height);\n\n    if (self.ctx.qrScanner) {\n        self.ctx.qrScanner._updateOverlay();\n    }\n}\n\nself.onDestroy = function() {\n    if (self.ctx.qrScanner) {\n        self.ctx.qrScanner.stop();\n        self.ctx.qrScanner.destroy();\n        self.ctx.qrScanner = null;\n    }\n}\n\nfunction hashCode(str) {\n    var hash = 0;\n    var i, char;\n    if (str.length === 0) return hash;\n    for (i = 0; i < str.length; i++) {\n        char = str.charCodeAt(i);\n        hash = ((hash << 5) - hash) + char;\n        hash = hash & hash;\n    }\n    return hash;\n}",
    "settingsSchema": "{\n    \"schema\": {\n        \"type\": \"object\",\n        \"title\": \"QR code scanner settings\",\n        \"properties\": {\n            \"style\": {\n                \"title\": \"Style of scanning region\",\n                \"type\": \"string\",\n                \"default\": \"stroke\"\n            },\n            \"strokeStyle\": {\n                \"title\": \"CSS\",\n                \"type\": \"string\",\n                \"default\": \"#qr-container.qr-stroke-style .scan-region-highlight-svg,\\n#qr-container.qr-stroke-style .code-outline-highlight {\\n    stroke: #FFFFFF !important;\\n}\\n#qr-video{\\n    object-fit: cover;\\n}\\n\"\n            },\n            \"shadowStyle\": {\n                \"title\": \"CSS\",\n                \"type\": \"string\",\n                \"default\": \"#qr-video{\\n    object-fit: cover;\\n}\\n#qr-container.qr-shadow-style {\\n    position: relative;\\n    width: max-content;\\n    height: max-content;\\n    overflow: hidden;\\n}\\n#qr-container.qr-shadow-style .scan-region-highlight {\\n    border-radius: 30px;\\n    outline: rgba(0, 0, 0, .25) solid 50vmax;\\n}\\n#qr-container.qr-shadow-style .scan-region-highlight-svg {\\n    display: none;\\n}\\n#qr-container.qr-shadow-style .code-outline-highlight {\\n    stroke: rgba(255, 255, 255, .5) !important;\\n    stroke-width: 15 !important;\\n    stroke-dasharray: none !important;\\n}\\n\"\n            },\n            \"customStyle\": {\n                \"title\": \"CSS\",\n                \"type\": \"string\",\n                \"default\": \"#qr-container {\\n\\n}\\n#qr-video{\\n    object-fit: cover;\\n}\\n#qr-container.scan-region-highlight-svg {\\n\\n}\\n#qr-container.code-outline-highlight{\\n\\n}\"\n            },\n            \"onScanSuccess\": {\n                \"title\": \"function (qrCode, ctx)\",\n                \"type\": \"string\",\n                \"default\": \"console.log('QR code: ', qrCode);\\nalert('QR code: ' + qrCode)\"\n            }\n        },\n        \"required\": [\n            \"style\",\n            \"onScanSuccess\"\n        ]\n    },\n    \"form\": [\n        {\n            \"key\": \"style\",\n            \"type\": \"rc-select\",\n            \"multiple\": false,\n            \"items\": [\n                {\n                    \"value\": \"stroke\",\n                    \"label\": \"Stroke\"\n                },\n                {\n                    \"value\": \"shadow\",\n                    \"label\": \"Shadow\"\n                },\n                {\n                    \"value\": \"custom\",\n                    \"label\": \"Custom\"\n                }\n            ]\n        },\n        {\n            \"key\": \"strokeStyle\",\n            \"type\": \"css\",\n            \"condition\": \"model.style === 'stroke'\"\n        },\n        {\n            \"key\": \"shadowStyle\",\n            \"type\": \"css\",\n            \"condition\": \"model.style === 'shadow'\"\n        },\n        {\n            \"key\": \"customStyle\",\n            \"type\": \"css\",\n            \"condition\": \"model.style === 'custom'\"\n        },\n        {\n            \"key\": \"onScanSuccess\",\n            \"type\": \"javascript\"\n        }\n    ]\n}",
    "dataKeySettingsSchema": "{}\n",
    "defaultConfig": "{\"datasources\":[{\"type\":\"static\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":false,\"backgroundColor\":\"rgb(255, 255, 255)\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{\"style\":\"stroke\",\"onScanSuccess\":\"console.log('QR code: ', qrCode);\\nalert('QR code: ' + qrCode)\",\"strokeStyle\":\"#qr-video {\\n    object-fit: cover;\\n}\\n#qr-container.qr-stroke-style .scan-region-highlight-svg,\\n#qr-container.qr-stroke-style .code-outline-highlight {\\n    stroke: #FFFFFF !important;\\n}\",\"shadowStyle\":\"#qr-video {\\n    object-fit: cover;\\n}\\n#qr-container.qr-shadow-style {\\n    position: relative;\\n    width: max-content;\\n    height: max-content;\\n    overflow: hidden;\\n}\\n#qr-container.qr-shadow-style .scan-region-highlight {\\n    border-radius: 30px;\\n    outline: rgba(0, 0, 0, .25) solid 50vmax;\\n}\\n#qr-container.qr-shadow-style .scan-region-highlight-svg {\\n    display: none;\\n}\\n#qr-container.qr-shadow-style .code-outline-highlight {\\n    stroke: rgba(255, 255, 255, .5) !important;\\n    stroke-width: 15 !important;\\n    stroke-dasharray: none !important;\\n}\\n\",\"customStyle\":\"#qr-container {\\n\\n}\\n#qr-video{\\n    object-fit: cover;\\n}\\n#qr-container.scan-region-highlight-svg {\\n\\n}\\n#qr-container.code-outline-highlight{\\n\\n}\"},\"title\":\"QR code scanner\",\"dropShadow\":true}"
  }
}